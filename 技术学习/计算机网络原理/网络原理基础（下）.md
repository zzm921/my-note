### TCP和UDP
#### TCP和UDP的区别
- 是否面向连接：UDP在传输数据之前不需要先建立连接。TCP是提供面向连接的服务。在传输数据之前必须先要建立连接，数据传送结束后要释放连接
- 是否是可靠传输:远地主机收到UPD的报文后，不需要给出任何确认，并且不保证数据不丢失，不保证是否顺序到达。TCP提供可靠的传输服务，TCP在传输之前会三次握手建立连接，而且数据传递时，有确认、窗口、重传、拥塞控制机制。通过TCP连接传输的数据，无差错、不丢失、无重复、并且按序到达。
- 是否有状态：这个上面的是否可靠传输对应，TCP传输是有状态的，这个有状态是指TCP会自己去记录消息的状态比如消息是否被发送、是哦否被接收等。为此，TCP需要维持复杂的连接状态表。而UDP是无状态服务，简单来说是不去管事后发生的事。
- 传输效率：TCP需要提前建立连接，进行传输时多了连接、确认、重传等机制，效率要比UDP低
- 传输形式：TCP是面向字节流，UDP是面向报文
- 首部开销：TCP首部开销20-60字节比UDP（8字节）要大。
- 是否提供广播或多播服务：TCP是点对点通信。UDP支持一对一、一对多、多对一、多对多。
![[Pasted image 20240116144654.png]]
#### 什么时候选择TCP，什么时候选择UDP
- UDP一般用于即时通信，比如语音、视频、直播等。
- TCP用于对传输准确性要求比较高的场景，比如文件传输、发送和接收邮件、远程登录等。
#### HTTP是基于TCP还是UDP
HTTP/3.0 之前是基于 TCP 协议的，而 HTTP/3.0 将弃用 TCP，改用 **基于 UDP 的 QUIC 协议** 。
此变化解决了2.0中存在的对头阻塞问题。对头阻塞是指在2.0中，多个HTTP请求和相应共享一个TCP连接，如果其中一个连接相应因为网络拥塞或丢包而被阻塞，那么后续的请求将也无法发送，导致整个连接效率降低。这是由于2.0在单TCP连接上使用了多路复用，受到TCP拥塞的影响，少量的丢包就会导致TCP连接上所有流程被阻塞。
3.0在一定程度上解决了对头阻塞问题，一个连接建立多个数据流，这些数据流之间相互独立互不影响，某个数据流发生丢包，其它数据流不受影响。

除了解决对头阻塞问题，3.0还可以减少握手的过程和延迟。在2.0中，如果要建立一个https连接，需要经过tcp三次握手和TLS握手：
1. TCP三次握手：客户端和服务器交换SYN和ACK包，建立一个TCP连接。这个过程需要1.5个RTT（round-trip time），即一个数据包从发送到接收的时间。
2. TLS握手：客户端和服务器交换秘钥和证书，建立一个TLS加密层。这个过程需要至少一个RTT（TLS 1.3）或2个RTT（TLS 1.2）
所以，HTTP/2.0 的连接建立就至少需要 2.5 个 RTT（TLS 1.3）或者 3.5 个 RTT（TLS 1.2）。而在3.0中，使用QUIC协议（TLS 1.3，TLS 1.3 除了支持 1 个 RTT 的握手，还支持 0 个 RTT 的握手）连接建立仅需 0-RTT 或者 1-RTT。这意味着 QUIC 在最佳情况下不需要任何的额外往返时间就可以建立新连接。

#### 使用TCP的协议有哪些？使用UDP的协议有哪些？
##### 基于TCP
1. HTTP协议（3.0之前）：超文本传输协议
2. HTTPS协议：更安全的超文本传输协议
3. FTP协议：文件传输协议（FIle TRansfer Protocol）
4. SMTP：简单邮件传输协议
5. POP3/IMAP：邮件接收协议
6. Telent：用于远程登录服务器
7. SSH协议：安全的网络传输协议
##### 基于UDP
1. HTTP/3.0
2. DHCP协议：动态主机配置协议，动态配置IP地址。
3. DNS：域名系统。DNS同时支持TCP和UDP
#### TCP 三次握手和四次挥手（非常重要）

**相关面试题**：
- 为什么要三次握手?
- 第 2 次握手传回了 ACK，为什么还要传回 SYN？
- 为什么要四次挥手？
- 为什么不能把服务器发送的 ACK 和 FIN 合并起来，变成三次挥手？
- 如果第二次挥手时服务器的 ACK 没有送达客户端，会怎样？
- 为什么第四次挥手客户端需要等待 2*MSL（报文段最长寿命）时间后才进入 CLOSED 状态？

#### TCP如何保证传输的可靠性


### IP
#### IP协议的作用是什么
IP（Internet Protocol，网际协议）是TCP/IP协议中最重要的协议之一，属于网络层协议，主要作用是定义数据包的格式、对数据包进行路由和寻址，以便它可以跨网络传播到正确的目的地。
目前IP协议分为两种，一种是IPv4，一种是IPv6
#### 什么是IP地址？IP寻址如何工作？
每个连入互联网的设备或域（如计算机、服务器、路由器灯）都会被分配一个IP地址，作为唯一标识。每个IP地址都是一个字符序列，如 192.168.1.1（IPv4）、2001:0db8:85a3:0000:0000:8a2e:0370:7334（IPv6） 。

当网络设备发送IP数据包的时候，数据包中包含源IP地址和目的IP地址。源IP地址用于标识数据包发送方设备或域，目的IP地址用于标识数据包接收方设备或域。

网络设备更具目的IP地址来判断数据包的目的地。并将数据转发到正确的网络或自网络，从而实现设备间的通信。

这种基于IP地址的寻址方式是互联网通信的基础，它允许数据包在不同网络间船底，从而实现了全球范围内的互联网互通。IP地址的唯一性和全局性保证了每个设备都可以通过其独特的IP地址进行标识和寻址。
![[Pasted image 20240116175532.png]]

#### 什么是IP地址过滤
**IP 地址过滤（IP Address Filtering）** 简单来说就是限制或阻止特定 IP 地址或 IP 地址范围的访问。例如，你有一个图片服务突然被某一个 IP 地址攻击，那我们就可以禁止这个 IP 地址访问图片服务。

IP 地址过滤是一种简单的网络安全措施，实际应用中一般会结合其他网络安全措施，如认证、授权、加密等一起使用。单独使用 IP 地址过滤并不能完全保证网络的安全。

#### IPv4和IPv6的区别
**IPv4（Internet Protocol version 4）** 是目前广泛使用的 IP 地址版本，其格式是四组由点分隔的数字，例如：123.89.46.72。IPv4 使用 32 位地址作为其 Internet 地址，这意味着共有约 42 亿（ 2^32）个可用 IP 地址。
![[Pasted image 20240116175651.png]]
这么少当然不够用啦！为了解决 IP 地址耗尽的问题，最根本的办法是采用具有更大地址空间的新版本 IP 协议 - **IPv6（Internet Protocol version 6）**。IPv6 地址使用更复杂的格式，该格式使用由单或双冒号分隔的一组数字和字母，例如：2001:0db8:85a3:0000:0000:8a2e:0370:7334 。IPv6 使用 128 位互联网地址，这意味着越有 2^128（3 开头的 39 位数字，恐怖如斯） 个可用 IP 地址。
![[Pasted image 20240116175812.png]]
除了更大的地址空间外，IPv6的优势还包括：
- **无状态地址自动配置（Stateless Address Autoconfiguration，简称 SLAAC）** ：主机可以直接通过根据接口表示和网络前缀生成全局唯一的IPv6，而无需依赖DHCP服务器，简化了网络配置和管理
- **NAT（网络地址转换）成为可选项**：IPv6地址资源充足，可以给全球每个设备一个独立的地址
- **对标头进行了改进**：IPv6标头结构相较于IPv4更加简化和高效，减少了处理开销，提高了网络性能。
- **可选的拓展头**：允许在IPv6标头中添加不同的拓展头，用于实现不同类型的功能和选项。
- **ICMPv6（Internet Control Message Protocol for IPv6）**：IPv6 中的 ICMPv6 相较于 IPv4 中的 ICMP 有了一些改进，如邻居发现、路径 MTU 发现等功能的改进，从而提升了网络的可靠性和性能。

#### 如何获取客户端真实IP

**应用层方法** ：
通过 X-Forwarded-For 请求头获取，简单方便。不过，这种方法无法保证获取到的是真实 IP，这是因为 X-Forwarded-For 字段可能会被伪造。如果经过多个代理服务器，X-Forwarded-For 字段可能会有多个值（附带了整个请求链中的所有代理服务器 IP 地址）。并且，这种方法只适用于 HTTP 和 SMTP 协议。

**传输层方法**：

利用 TCP Options 字段承载真实源 IP 信息。这种方法适用于任何基于 TCP 的协议，不受应用层的限制。不过，这并非是 TCP 标准所支持的，所以需要通信双方都进行改造。也就是：对于发送方来说，需要有能力把真实源 IP 插入到 TCP Options 里面。对于接收方来说，需要有能力把 TCP Options 里面的 IP 地址读取出来。

也可以通过 Proxy Protocol 协议来传递客户端 IP 和 Port 信息。这种方法可以利用 Nginx 或者其他支持该协议的反向代理服务器来获取真实 IP 或者在业务服务器解析真实 IP。

**网络层方法**：

隧道 +DSR 模式。这种方法可以适用于任何协议，就是实施起来会比较麻烦，也存在一定限制，实际应用中一般不会使用这种方法。

#### NAT的作用
NAT（Network Address Translation，网络地址转换）主要用于在不同网络之间转换IP地址。它允许将私有的IP地址映射为共有的IP地址或者反向映射，从而实现局域网内多个设备通过单一共有IP地址访问互联网

NAT不光可以缓解IPv4地址资源短缺问题，还可以隐藏内部网络的实际拓扑结构，使得外部网络无法直接访问内部网络中的设备，从而提高内部网络的安全。
![[Pasted image 20240116180716.png]]
### ARP
#### 什么是Mac地址
MAC地址的全程是媒体访问控制地址（Media Access Control Address）。如果说，虎粮网中一个资源都由IP地址唯一标识（IP协议内容），那么一切网络设备都由MAC地址唯一标识。
可以理解为，MAC地址是一个网络设备真正的身份证号，IP地址是一种不重复的定位方式（比如说住在某省某市某街道的张三，这种逻辑定位是 IP 地址，他的身份证号才是他的 MAC 地址），也可以理解为 MAC 地址是身份证号，IP 地址是邮政地址。MAC 地址也有一些别称，如 LAN 地址、物理地址、以太网地址等。

	还有一点要知道的是，不仅仅是网络资源才有IP地址，网络设备也有IP地址，网络设备也有IP地址，比如路由器。但从结构上说，路由器等网络设备的作用是组成一个网络，而且通常是内网，所以他们使用的IP地址通常是内网IP，内网的设备在与内网以外的设备进行通信时，需要用到NAT协议。
	
MAC 地址的长度为 6 字节（48 比特），地址空间大小有 280 万亿之多（248），MAC 地址由 IEEE 统一管理与分配，理论上，一个网络设备中的网卡上的 MAC 地址是永久的。不同的网卡生产商从 IEEE 那里购买自己的 MAC 地址空间（MAC 的前 24 比特），也就是前 24 比特由 IEEE 统一管理，保证不会重复。而后 24 比特，由各家生产商自己管理，同样保证生产的两块网卡的 MAC 地址不会重复。

MAC 地址具有可携带性、永久性，身份证号永久地标识一个人的身份，不论他到哪里都不会改变。而 IP 地址不具有这些性质，当一台设备更换了网络，它的 IP 地址也就可能发生改变，也就是它在互联网中的定位发生了变化。

最后，记住，MAC 地址有一个特殊地址：FF-FF-FF-FF-FF-FF（全 1 地址），该地址表示广播地址。

#### ARP协议解决了什么问题
ARP协议，全程地址解析协议（Address Resolution Protocol），它解决的是网络层地址和链路层地址之间的转换问题。因为一个IP数据报在物理上传输的过程，总是需要知道下一跳（物理上的下一个目的地）该去往何处，但IP地址属于逻辑地址，而MAC地址才是物理地址，ARP协议解决了IP地址转MAC地址的一些问题。

#### ARP协议的工作原理